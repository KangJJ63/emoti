<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/static/css/login.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script>

        function loginSuccess() {
            // 로그인 성공 시 부모 페이지에 메시지 전송하여 모달을 닫음
            window.opener.postMessage('closeModal', '*');
        }

        function loginFailure() {
            // 로그인 실패 시 아무 동작도 수행하지 않음
            // 실패 시 원하는 동작을 추가할 수 있음
        }
    </script>

    
</head>
    <body>
        <!-- <div class="loginpage" id="loginPage"> =
            <form class="loginForm" action="/login" method="post"> 
                <h2>로그인</h2>
                <input class="loginText" type="text" name="username" placeholder="이메일" required>
                <input class="loginPassword" type="password" name="password" placeholder="비밀번호" required>
                <input class="loginSubmit" type="submit" value="로그인">
                <button class="signup-button" onclick="openJoinPopup()">회원가입</button> -->
                <!-- <script> -->

                <!-- <script>
                    function openJoinPopup() {
                        var popup = window.open("/joinPage", "_self");
                    }
                </script> -->

                <div class="loginpage" id="loginPage">
                    <form class="loginForm" id="loginForm" action="/login" method="post" onsubmit="login(event)">
                        <h2>로그인</h2>
                        <input class="loginText" type="text" name="username" placeholder="이메일" required>
                        <input class="loginPassword" type="password" name="password" placeholder="비밀번호" required>
                        <input class="loginSubmit" type="submit" value="로그인">
                        <button class="signup-button" onclick="openJoinPopup()">회원가입</button>
                    </form>
                </div>
                <script>
                    function login(event) {
                        event.preventDefault(); // 폼의 기본 제출 동작 방지
                
                        var xhr = new XMLHttpRequest();
                        xhr.onreadystatechange = function() {
                            if (xhr.readyState === 4) {
                                if (xhr.status === 200) {
                                    // 로그인이 성공하면 팝업 창을 닫음
                                    closePopup();
                                } else {
                                    console.error("Failed to login:", xhr.status);
                                    // 로그인 실패시 처리
                                }
                            }
                        };
                        xhr.open("POST", "/login", true);
                        var formData = new FormData(document.getElementById("loginForm"));
                        xhr.send(formData);
                    }

                    function openJoinPopup() {
                        // Ajax 호출을 통해 joinPage를 가져옴
                        var xhr = new XMLHttpRequest();
                        xhr.onreadystatechange = function() {
                            if (xhr.readyState === 4) {
                                if (xhr.status === 200) {
                                    var popupContent = xhr.responseText;
                                    console.log("popupContent : "+popupContent);
                                    replaceContent(popupContent);
                                } else {
                                    console.error("Failed to load joinPage:", xhr.status);
                                    // 에러 처리
                                }
                            }
                        };
                        xhr.open("GET", "/joinPage", true);
                        xhr.send();
                    }
                
                    function replaceContent(content) {
                        document.open();
                        document.write(content);
                        document.close();
                    }

                    
            
                function closePopup() {
                    var popup = document.getElementById("popup");
                    var overlay = document.getElementById("overlay");
                    popup.style.display = "none";
                    overlay.style.display = "none";
                    currentPopup = null;
                }
                </script>
                

                <div class="social-login">
                    <img src="/static/img/smile.png" onclick="kakaoLogin()">
                    <img src="/static/img/smile.png" onclick="naverLogin()">
                    <img src="/static/img/smile.png" onclick="googleLogin()">
                </div>
            </form>
        
        </div>    
    </body>
</html>